var t;const e=new((t=class{constructor(t){console.log(t),this.board=t||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.status="idle",this.handleKeyDown=this.handleKeyDown.bind(this),this.hasStarted=!1}startToRestart(){if(!this.hasStarted){let t=document.querySelector(".start");t.textContent="Restart",t.classList.remove("start"),t.classList.add("restart"),this.hasStarted=!0}}updateScore(){let t=document.querySelector(".game-score");t&&(t.textContent=this.score)}handleKeyDown(t){"lose"!==this.status&&"win"!==this.status&&("ArrowLeft"===t.code&&this.moveLeft(),"ArrowRight"===t.code&&this.moveRight(),"ArrowUp"===t.code&&this.moveUp(),"ArrowDown"===t.code&&this.moveDown())}setupControls(){this.controlsSet||(document.addEventListener("keydown",this.handleKeyDown),this.controlsSet=!0)}addRandomTile(){let t=[];for(let e=0;e<this.board.length;e++)for(let s=0;s<this.board[e].length;s++)0===this.board[e][s]&&t.push([e,s]);if(t.length>0){let e=Math.floor(Math.random()*t.length),s=.9>Math.random()?2:4;this.board[t[e][0]][t[e][1]]=s}}moveLeft(){let t=JSON.stringify(this.board);for(let t=0;t<this.board.length;t++){let e=[];for(let s=0;s<this.board[t].length;s++)0!==this.board[t][s]&&e.push(this.board[t][s]);for(let t=0;t<e.length;t++)e[t]===e[t+1]&&(e[t]*=2,e.splice(t+1,1),this.score+=e[t],e.push(0),t++);for(;e.length<this.board[t].length;)e.push(0);this.board[t]=e}t!==JSON.stringify(this.board)&&this.addRandomTile(),this.getStatus(),this.render(),this.updateScore(),this.startToRestart()}moveRight(){let t=JSON.stringify(this.board);for(let t=0;t<this.board.length;t++){let e=this.board[t].filter(t=>0!==t).reverse();for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,this.score+=e[t],e.splice(t+1,1));for(;e.length<4;)e.push(0);this.board[t]=e.reverse()}t!==JSON.stringify(this.board)&&this.addRandomTile(),this.getStatus(),this.render(),this.updateScore(),this.startToRestart()}moveUp(){let t=JSON.stringify(this.board);for(let t=0;t<this.board[0].length;t++){let e=[];for(let s=0;s<this.board.length;s++)0!==this.board[s][t]&&e.push(this.board[s][t]);for(let t=0;t<e.length;t++)e[t]===e[t+1]&&(e[t]*=2,e.splice(t+1,1),this.score+=e[t],e.push(0),t++);for(;e.length<this.board.length;)e.push(0);for(let s=0;s<this.board.length;s++)this.board[s][t]=e[s]}t!==JSON.stringify(this.board)&&this.addRandomTile(),this.getStatus(),this.render(),this.updateScore(),this.startToRestart()}moveDown(){let t=JSON.stringify(this.board);for(let t=0;t<this.board[0].length;t++){let e=[];for(let s=this.board.length-1;s>=0;s--)0!==this.board[s][t]&&e.push(this.board[s][t]);for(let t=0;t<e.length;t++)e[t]===e[t+1]&&(e[t]*=2,e.splice(t+1,1),this.score+=e[t],e.push(0),t++);for(;e.length<this.board.length;)e.push(0);for(let s=this.board.length-1;s>=0;s--)this.board[s][t]=e[this.board.length-1-s]}t!==JSON.stringify(this.board)&&this.addRandomTile(),this.getStatus(),this.render(),this.updateScore(),this.startToRestart()}getScore(){return this.render(),this.score}getState(){return this.board}getStatus(){for(let t=0;t<this.board.length;t++)for(let e=0;e<this.board[t].length;e++){if(2048===this.board[t][e])return this.status="win",this.status;if(0===this.board[t][e]||e<3&&this.board[t][e]===this.board[t][e+1]||t<3&&this.board[t][e]===this.board[t+1][e])return this.status="playing",this.status}return this.status="lose",this.status}start(){let t,e;this.board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.status="playing";let s=[];for(let t=0;t<this.board.length;t++)for(let e=0;e<this.board[t].length;e++)0===this.board[t][e]&&s.push([t,e]);do t=Math.floor(Math.random()*s.length),e=Math.floor(Math.random()*s.length);while(t===e)let r=.9>Math.random()?2:4;this.board[s[t][0]][s[t][1]]=r;let o=.9>Math.random()?2:4;this.board[s[e][0]][s[e][1]]=o,this.setupControls(),this.render()}restart(){this.score=0,this.updateScore(),this.start()}renderCell(t,e){t.className="field-cell",0!==e?(t.classList.add(`field-cell--${e}`),t.textContent=e):t.textContent=""}render(){let t=document.querySelectorAll(".field-cell");for(let e=0;e<this.board.length;e++)for(let s=0;s<this.board.length;s++){let r=e*this.board.length+s,o=this.board[e][s];t[r].textContent=0===o?"":o}let e=document.querySelector(".score");e&&(e.textContent=this.score),document.querySelectorAll(".field-cell").forEach((t,e)=>{let s=Math.floor(e/4),r=this.board[s][e%4];this.renderCell(t,r)});let s=document.querySelector(".message-win"),r=document.querySelector(".message-lose"),o=document.querySelector(".message-start");s&&("win"===this.status?s.classList.remove("hidden"):s.classList.add("hidden")),r&&("lose"===this.status?r.classList.remove("hidden"):r.classList.add("hidden")),o&&"idle"!==this.status&&o.classList.add("hidden")}},t.__esModule)?t.default:t);document.querySelector(".start").addEventListener("click",()=>{e.hasStarted?e.restart():e.start()});
//# sourceMappingURL=js_2048-game.c4223c8c.js.map
